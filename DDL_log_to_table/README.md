# Как в PostgreSQL журналировать DDL команды в таблицу БД?

DDL команды обычно логируются в общем большом файловом журнале. Там полно SELECT и DML команд, отыскать там DDL непросто.
DDL запросы ещё могут сохраняться в Graylog, но отыскать там DDL тоже непросто.
Там нет чётко выделенного идентификатора объекта БД и события, только тело DDL команды.
Файловые журналы обычно хранятся несколько недель и потом автоматически удаляются.

Логирование DDL команд в отдельной таблице БД позволяет:
1. Усилить безопасность БД:
    * сохранять легальные изменения схемы БД администраторами БД (DBA), включая ручные (неавтоматические) миграции БД
    * выявить нелегальные изменения схемы БД: прямое выполнения DDL команд мимо миграторов БД; SQL injection
1. Сохранять следующие события:
    * Создание, удаление, модификация объектов БД (schema, table, view, column, sequence, index, type, function, procedure, domain), включая изменение владельца
    * Наделение и отзыв прав доступа к объектам БД
    * Создание, удаление, модификация пользователей и ролей, включая изменение атрибутов и пароля.
1. Иметь возможность получить и предоставить данные по запросу коллег при возникновении инцидентов, включая нестабильность работы БД. При этом будет возможность получить точную дату-время начала и окончания, а так же длительность выполнения DDL запросов в транзакции.
1. Знать дату-время создания и обновления объектов БД (к сожалению, в БД такая информация в системных таблицах отсутствует), чтобы потом автоматически их удалять через 1 месяц после создания из схем:
    * `migration` — здесь хранятся таблицы для отката накаченных миграций БД
    * `unused` — здесь хранятся неиспользуемые и уже ненужные объекты БД
1. Выявить DDL запросы в бизнес-логике приложения (такие запросы должны выполняться под отдельным пользователем?).
1. Для отдела информационной безопасности появляется возможность интеграции с [SIEM](https://ru.wikipedia.org/wiki/SIEM) в качестве источника данных.
